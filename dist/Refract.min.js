// Version 2021.9.8.2222
// License: MIT
function t(e,i,r=null,l=[],s=1,n=1,o=0){for(r=r||Object.keys(e)[0],i+="";i.length>o;){let h,a,u=i.slice(o);t:for(var f in e[r]){let t=e[r][f];t=Array.isArray(t)?t:[t];for(let e of t)if(e instanceof RegExp?a=(u.match(e)||[])[0]:"function"==typeof e?[a,h]=e(u,i.slice(0,o),l)||[]:u.startsWith(e)&&(a=e),void 0!==a)break t}if(a=Object.assign(a,{type:f,mode:h&&-1!==h?h:r,line:s,col:n}),-1===h)return[...l,a];if(h){let l=[a,...t(e,i,h,[],s,n+a.length,o+a.length)].filter((t=>t.length));a=Object.assign(l.join(""),{type:f,tokens:l,mode:r,line:s,col:n})}if(a.length){o+=a.length,l.push(a),s+=(a.match(/\n/g)||[]).length;let t=a.lastIndexOf("\n");n=(t>-1?-t:n)+a.length}}return l}var e=(t,e,i)=>r=>{if(t instanceof RegExp){let l=r.match(t)||[];if(l.length)return i&&i(l),[l[0],e]}else if(r.startsWith(t))return i&&i(t),[t,e]},i=t=>e=>{if(t instanceof RegExp){let i=e.match(t)||[];if(i.length)return[i[0],-1]}else if(e.startsWith(t))return[t,-1]};{let t=null,l=0,s=0,n=/^[ \t\v\f\xa0]+/,o=/^\r?\n/,f=/^<!?([\-_\w\xA0-\uFFFF]+)/i,h=/^<\/[\-_$\w\xA0-\uFFFF]+\s*>/i,a=t=>{if(r.allowHashTemplates&&t.startsWith("#{")||t.startsWith("${"))return s>0||(s=1),l=0,[t.slice(0,2),"js"]},u=t=>{if("`"===t[0])return--s,["`",-1]},c={attribute:/^[\-_$\w\xA0-\uFFFF]+/i,string:[e("'","squote"),e('"',"dquote")],equals:"=",tagEnd:t=>">"===t[0]?[">",-1]:t.startsWith("/>")?["/>",-1]:void 0,whitespace:[n,o],unknown:t=>r.allowUnknownTagTokens?t.match(/^\w+|\S/)||[]:void 0},p=(e,i,r)=>{let l=r[r.length-1];if("script"===t&&l&&l.tokens&&">"==l.tokens[l.tokens.length-1])return["","js"]},d="null true false Infinity NaN undefined globalThis".split(/ /g),m="await break case catch class constructor const continue debugger default delete do enum else export extends\n\t\t\t\tfinally for function if implements import in instanceof interface let new package private protected public\n\t\t\t\treturn static super switch this throw try typeof var void while with yield".split(/\s+/g),b="{ ( [ . ; , < > <= >= == != === !== + - * % << >> >>> & | ^ ! ~ && || ? : = += -= *= %= <<= >>= >>>= &= |= ^= /=".split(/ /g);var r={js:{whitespace:n,ln:o,semicolon:";",comment:[/^\/\/.*(?=\r?\n)/,/^\/\*[\s\S]*?\*\//],template(t){if("`"===t[0])return++s,l=0,["`","template"]},brace1(t){if("{"===t[0])return l++,["{"]},brace2(t){if("}"===t[0])return 0===l&&s?["}",-1]:(l--,["}"])},hex:/^0x[0-9a-f]+/i,number:/^\d*\.?\d+(e\d+)?/,end:t=>t.startsWith("<\/script>")?["",-1]:void 0,regex(t,e,i){if("/"!==t[0])return;if(i.length){let t;for(let e=i.length-1;e>=0;e--)if("ln"!==i[e].type&&"whitespace"!==i[e].type&&"comment"!==i[e].type){t=i[e]+"";break}if(!b.includes(t))return}let r=1;for(;;){if(r=t.indexOf("/",r+1),-1===r)return;try{let e=t.slice(0,r+1);return RegExp(e.slice(1,-1)),[e+t.slice(e.length).match(/^[agimsx]*/)[0]]}catch(t){}}},operator:"&& || ! => <<= >>= &= ^= |= &&= ||= & | ^ ~ >>> << >> === !=== == != >= > <= < = **= += -= *= /= %= ??= ++ -- ** + - * / % , ... . ( ) [ ] ? :".split(/ /g),identifier(t){let e=(t.match(/^[_$a-z\xA0-\uFFFF][_$\w\xA0-\uFFFF]*/i)||[])[0];if(!m.includes(e)&&!d.includes(e))return[e]},value:d,keyword:m,string:[/^"(\\\\|\\"|[^"])*"/,/^'(\\\\|\\'|[^'])*'/]},html:{script:p,comment:e("\x3c!--","htmlComment"),closeTag:h,openTag:e(f,"tag",(e=>t=e[1])),text:/^[\s\S]*?(?=<|$)/},htmlComment:{commentEnd:i("--\x3e"),commentBody:/^[\s\S]*?(?=-->|$)/},template:{script:p,expr:a,comment:e("\x3c!--","templateComment"),closeTag:h,openTag:e(f,"templateTag",(e=>t=e[1])),template:u,text:t=>t.match(r.allowHashTemplates?/^[\s\S]+?(?=<|`|(?<!\\)\${|(?<!\\)#{|(?=$))/:/^[\s\S]+?(?=<|`|(?<!\\)\${|(?=$))/)||[]},templateComment:{expr:a,commentEnd:i("--\x3e"),commentBody:t=>t.match(r.allowHashTemplates?/^[\s\S]+?(?=-->|\${|#{|$)/:/^[\s\S]+?(?=-->|\${|$)/)||[]},tag:c,templateTag:{expr:a,template:u,...c},squote:{expr:a,quote:i("'"),text:/^[\s\S]+?(?=(?<!\\)\${|(?<!\\\$?){|<|`|')/},dquote:{expr:a,quote:i('"'),text:/^[\s\S]+?(?=(?<!\\)\${|(?<!\\\$?){|<|`|")/},allowHashTemplates:!1,allowUnknownTagTokens:!1}}function l(...t){return e=>{let i=0;for(let r of s(t)){let t=r(e.slice(i));if(!1===t)return!1;i+=t}return i}}l.or=(...t)=>e=>{for(let i of s(t)){let t=i(e);if(!1!==t)return t}return!1},l.not=(...t)=>{let e=l(t);return t=>!1===e(t)&&0},l.nor=(...t)=>e=>{for(let i of s(t))if(i(e)>0)return!1;return 1},l.zeroOrOne=(...t)=>{let e=l(t);return t=>{let i=e(t);return!1===i?0:i}},l.xOrMore=(t,...e)=>{let i=l(e);return e=>{let r=0;for(let l=0;e.length;l++){let s=i(e);if(!1===s)return l>=t&&r;r+=s||1,e=e.slice(s||1)}return r}},l.zeroOrMore=(...t)=>l.xOrMore(0,...t),l.oneOrMore=(...t)=>l.xOrMore(1,...t),l.matchFirst=(t,e,i=0)=>{let r=l.matchAll(t,e,1,i);return r.length?r[0]:null},l.matchAll=(t,e,i=1/0,r=0)=>{Array.isArray(t)&&(t=l(t));let s=[];for(let l=r;e.length>l&&i>s.length;l++){let i=t(e.slice(l));!1!==i&&s.push(Object.assign(e.slice(l,l+i),{index:l}))}return s},l.lookAhead=(...t)=>e=>{for(let i of s(t))if(!1===i(e))return!1;return 0},l.end=t=>!t.length&&0;var s=t=>{Array.isArray(t[0])&&1===t.length&&(t=t[0]);let e=[];for(let i in t){let r=t[i];e[i]="string"==typeof r?t=>t[0]==r:Array.isArray(r)?l(r):"object"!=typeof r||r.prototype?t[i]:t=>{for(let e in r)if(t[0][e]!=r[e])return!1;return 1}}return e};let n=l.lookAhead(l.or(l.end,l.not("("))),o=l(l.or(l(".",{type:"identifier"}),l("[",l.or({type:"string"},{type:"number"}),"]")),n);var f={t(t=[]){return l(l.or(l("this",l.oneOrMore(o)),...t.map((t=>l(t,l.zeroOrMore(o))))),n)},filterArgNames(t){let e=[],i=1;for(let r of t)1===i&&"identifier"===r.type&&e.push(r+""),i={",":1,"=":-1}[r]||i;return e},replaceHashExpr(t,e,i){let r=[],l=!1;for(let e of t)if(e.tokens){let t=f.replaceHashExpr(e.tokens,e.mode,i);r.push(Object.assign(t.join(""),{type:e.type,tokens:t,mode:e.mode}))}else"#{"==e&&"expr"==e.type?(r.push("${",i,".","htmlEncode","("),l=!0):r.push(e+"");if(l){let t=[];"squote"===e?t=[",",'"\'"']:"dquote"===e&&(t=[",","'\"'"]),r.splice(r.length-1,0,...t,")")}return r},i(t,e=[]){let i=[f.t(e),".","map","("],r=[l.or([{type:"identifier"},["(",f.argList,")"]]),"=>"],s=l.matchFirst(i,t);if(!s)return[null,null];let n=l.matchFirst(r,t.slice(s.length));if(!n)return[null,null];let o=f.filterArgNames(t.slice(s.length,s.length+n.length)),h=[],a=0,u=0,c=0,p=t.slice(s.length+n.length);for(let t,e=0;t=p[e];e++){if(a+=0|{"{":1,"}":-1}[t],u+=0|{"[":1,"]":-1}[t],c+=0|{"(":1,")":-1}[t],0===a&&0===u&&-1===c){if(e===p.length-1)return[o,h];break}h.push(t)}return[null,null]},l(t,e=[]){},o(t,e=[]){return l.matchAll(f.t(e),t).filter((e=>"."!=t[e.index-1]))},u(t){let e=[];for(let i of t)"this"==i||"identifier"===i.type||"number"===i.type?e.push(i+""):"string"===i.type&&e.push(JSON.parse(i));return e}};f.ws=l.zeroOrMore(l.or({type:"whitespace"},{type:"ln"})),f.arg=l([{type:"identifier"},f.ws,l.zeroOrOne(["=",f.ws,l.or([{type:"hex"},{type:"number"},{type:"regex"},{type:"string"},{type:"identifier"}])])]),f.argList=l.zeroOrMore([f.arg,l.zeroOrMore([f.ws,",",f.ws,f.arg])]);var h={};function a(t,e,i=h,r=!1){let l=i!==h;if(!t&&!l&&e.length)return;let s=0;for(let n of e){let o=s===e.length-1;if(r&&((t=t.$removeProxy||t).$disableWatch=!0),void 0===t[n]){if(!l)return void delete t.$disableWatch;o||(t[n]=(e[s+1]+"").match(/^\d+$/)?[]:{})}o&&l&&(t[n]=i),r&&delete t.$disableWatch,t=t[n],r&&(t=null!=t?t.$removeProxy||t:null),s++}return t}a.dontCreateValue=h;var u={};Object.keys(document.__proto__.__proto__).map((t=>t.startsWith("on")?u[t]=!0:0));var c=t=>t&&t.$removeProxy||t,p={arrayEq(t,e){if(t.length!==e.length)return!1;for(let i=0;t.length>i;i++)if(t[i]!==e[i])return!1;return!0},arrayStartsWith(t,e){for(let i=0;e.length>i;i++)if(t[i]!==e[i])return!1;return!0},p(t,e){for(let i in t)if(i.startsWith(e))return!0;return!1}},d=t=>JSON.stringify(t).slice(1,-1),m=t=>t&&"object"==typeof t,b=(t,e)=>{if(null==t)return t;if(t.$isProxy&&(t=t.$removeProxy),"object"==typeof t){if(e){if(e.has(t))return t}else e=new WeakSet;e.add(t);for(let i in Object.keys(t)){let r=t[i],l=b(r,e);if(l!==r)if(Object.getOwnPropertyDescriptor(t,i).writable)t[i]=l;else{let e=watch.objects.get(t);(e?e.m:t)[i]=l}}}return t};{let t=["indexOf","lastIndexOf","includes"],e=["push","pop","splice","shift","sort","reverse","unshift"],i={get(t,e){if("$"===e[0]){if("$removeProxy"===e)return t;if("$isProxy"===e)return!0;if("$trigger"===e)return e=>{let i=y.getRoots(t);for(let r of i)for(let i of y.getCallbacks(r))i("set",e||[],t);return i}}let i=t[e];if(e===Symbol.iterator)return i;if("function"==typeof i){let i=t.$removeProxy||t;return i[e].bind(i)}if(i&&"object"==typeof i){i=i.$removeProxy||i;let r=y.getRoots(t);for(let l of r){let r=y.getPaths(l,t);for(let t of r)y.addPath(l,[...t,e],i)}return y.getProxy(i)}return i},set(t,e,r){let l=t[e];r=b(r),t[e]=r;let s=i.getWatchedPaths(t,e);for(let t of s){let e=y.getCallbacks(t[0]);for(let i of e)i("set",t[1],r,l,t[0])}return!0},getWatchedPaths(t,e){let i=y.getRoots(t),r=[];for(let l of i){let i=y.getPaths(l,t);for(let t of i){let i=[...t,e];r.push([l,i])}}return r},deleteProperty(t,e){Array.isArray(t)?t.splice(e,1):delete t[e];let i=y.getRoots(t);for(let r of i){let i=y.getPaths(r,t);for(let t of i){let i=[...t,e];for(let t of y.getCallbacks(r))t("set",i)}}return!0}};var y={proxies:new WeakMap,roots:new WeakMap,callbacks:new WeakMap,paths:new WeakMap,getProxy(r){let l=y.proxies.get(r);if(!l&&(y.proxies.set(r,l=new Proxy(r,i)),Array.isArray(r))){for(let e of t)Object.defineProperty(l,e,{enumerable:!1,get:()=>t=>Array.prototype[e].call(r,c(t))});for(let t of e)Object.defineProperty(l,t,{configurable:!0,enumerable:!1,get:()=>(...e)=>y.arrayFunction(r,t,e)})}return l},arrayFunction(t,e,i){let r=t.length,l=0;"push"===e?l=r:"pop"===e?l=r-1:"splice"===e&&(l=0>i[0]?r-i[0]:i[0]);let s=Array.prototype[e].apply(t,i);["splice","shift","sort","reverse","unshift"].includes(e)&&y.rebuildArray(t,l,null,null);let n=Array.from(y.getRoots(t));for(let f of n){let n=y.getPaths(f,t);for(let h of y.getCallbacks(f))for(let a of n)if("pop"===e)h("remove",[...a,l+""],s,null,f);else if("shift"===e)h("remove",[...a,"0"],s,null,f);else if("unshift"===e)h("insert",[...a,"0"],t[0],null,f);else if("splice"===e){let e=i[1],r=i.length-2,n=Math.min(r,e);for(o=0;n>o;o++)h("set",[...a,l+o+""],t[l+o],null,f);if(r>e)for(o=n;r>o;o++)h("insert",[...a,l+o+""],t[l+o],null,f);else if(e>r)for(o=e-1;o>=n;o--)h("remove",[...a,l+o+""],s[o-n+1],null,f)}else{for(var o=l;t.length>o;o++)h("set",[...a,o+""],t[o],null,f);for(;r>o;o++)h("delete",[...a,o+""],null,f)}}return s},rebuildArray(t,e,i,r){if(i=i||[],void 0===e&&(e=0),!(r=r||new WeakSet).has(t)){if(r.add(t),i.length){let e=y.roots.get(t);if(!e)return;for(let r of e){let e=y.getPaths(r,t);for(let l in e){let s=e[l],n=s.length-i.length;if(n>=0){let o=s.slice();for(let t=n;s.length>t;t++)o[t]=i[t-n];let f=r;for(let t of o)if(f=f[t],!f)break;f===t&&(e[l]=o)}}}}if(Array.isArray(t))for(let l=e;t.length>l;l++)(Array.isArray(t[l])||m(t[l]))&&y.rebuildArray(t[l],0,[...i,l+""],r);else if(m(t))for(let e in t)(Array.isArray(t[e])||m(t[e]))&&y.rebuildArray(t[e],0,[...i,e+""],r)}},getRoots(t){return y.roots.get(t=t.$removeProxy||t)||[]},addPath(t,e,i){t=t.$removeProxy||t;let r=y.roots.get(i=i.$removeProxy||i);r||y.roots.set(i,r=new Set),r.add(t);let l=y.paths.get(t);l||y.paths.set(t,l=new WeakMap);let s=l.get(i);if(s){for(let t of s){let i=t.length;if(i>e.length)continue;let r=!1;for(let l=0;i>l&&!(r=t[l]!==e[l]);l++);if(!r)return}s.push(e)}else l.set(i,[e])},getPaths(t,e){let i=y.paths.get(t);return i&&i.get(e.$removeProxy||e)||[]},addCallback(t,e){let i=y.callbacks.get(t=t.$removeProxy||t);i||y.callbacks.set(t,i=[]),i.push(e)},getCallbacks(t){return y.callbacks.get(t=t.$removeProxy||t)||[]}},g=(t,e)=>(y.addPath(t,[],t),y.addCallback(t,e),y.getProxy(t))}class x{constructor(t){this.g=t,this.m={},this.v=g(this.m,this.$.bind(this)),this.j={}}$(t,e,i,r){let l=[];if("info"===t)return this.j;let s=d(e),n=e.slice(0,-1);for(;n.length;){let s=d(n);if(s in this.j)for(let n of this.j[s])l.push([n,[t,e,i,r,this.g]]);n.pop()}if(s in this.j)for(let n of this.j[s])l.push([n,[t,e,i,r,this.g]]);let o=a(this.g,e,a.dontCreateValue,!0);for(let e in this.j)if(e.startsWith(s)&&e.length>s.length){let i=e.slice(s.length>0?s.length+1:s.length),n=JSON.parse("["+i+"]"),f=c(a(r,n,a.dontCreateValue,!0)),h=c(a(o,n,a.dontCreateValue,!0));if(f!==h){let i=this.j[e];if(i.length){let r=JSON.parse("["+e+"]");for(let e of i)l.push([e,[t,r,h,f,this.g]])}}}for(let t of l)t[0].apply(this.g,t[1])}O(t,e){t.startsWith&&(t=[t]);let i=this,r=t[0];r in i.m||(i.m[r]=i.g[r],delete i.g[r],Object.defineProperty(i.g,r,{enumerable:1,configurable:1,get:()=>i.g.$disableWatch?i.m[r]:i.v[r],set(t){i.g.$disableWatch?i.v.$removeProxy[r]=t:i.v[r]=t}})),a(this.m,t,void 0);let l=d(t);l in i.j||(i.j[l]=[]),i.j[l].push(e)}k(t,e){t.startsWith&&(t=[t]);let i=d(t);if(i in this.j){if(e){let t=this.j[i].indexOf(e);this.j[i].splice(t,1)}if(!e||!this.j[i].length){delete this.j[i];let e=d([t[0]]);if(!p.p(this.j,e)){delete this.g[t[0]],this.g[t[0]]=this.m[t[0]];let e=y.roots.get(this.m[t[0]]);e&&(e.delete(this.m),e.size||y.roots.delete(this.m[t[0]])),delete this.m[t[0]],Object.keys(this.m).length||(y.paths.delete(this.m),y.roots.delete(this.m),y.roots.delete(this.g[t[0]])),Object.keys(this.g).length||(y.paths.delete(this.g),y.roots.delete(this.g))}}}}}var v={objects:new WeakMap,add(t,e,i){t=c(t);var r=v.objects.get(t);r||v.objects.set(t,r=new x(t)),r.O(e,i)},remove(t,e,i){t=c(t);var r=v.objects.get(t);if(r){if(e)r.k(e,i);else for(let t in r.j)r.k(t);Object.keys(r.j).length||v.objects.delete(t)}},cleanup(){v.objects=new WeakMap}};class w{text="";el=null;startIndex=0;constructor(t){this.text=t}apply(t=null,e=null){return e?this.el=e:(this.el?this.el.textContent=this.text:(this.el=document.createTextNode(this.text),t.insertBefore(this.el,t.childNodes[this.startIndex])),_.elsCreated&&_.elsCreated.push(this.text+"")),1}clone(){let t=new w;return t.text=this.text,t}remove(){this.el.parentNode.removeChild(this.el)}}var $=document.createElement("textarea"),j={decode(t){return $.innerHTML=t,$.value}};class O{watchPaths=[];attrName=null;type="simple";isHash=!1;exec=null;loopParamNames=[];loopItemEls=[];xel=null;parent=null;vParent=null;vChildren=[];scope={};startIndex=0;childCount=0;watches=[];constructor(){}apply(t=null,e=null){this.parent=t||this.parent;for(let t of this.vChildren)for(let e of t)e.remove();this.vChildren=this.evaluate();let i=0,r=this.startIndex;for(let t of this.vChildren)for(let e of t){e.startIndex=r;let t=e.apply(this.parent,null);r+=t,i+=t}return i}clone(t=null,e=null,i=null){let r=new O;return r.watchPaths=this.watchPaths,r.attrName=this.attrName,r.type=this.type,r.exec=this.exec,r.loopParamNames=this.loopParamNames,r.loopItemEls=this.loopItemEls,r.xel=t||this.xel,r.parent=i||this.parent,r.vParent=e||this.vParent,r.startIndex=this.startIndex,r.childCount=this.childCount,r.scope={...this.scope},r.isHash=this.isHash,r}evaluate(){for(let t of this.watches)v.remove(...t);this.watches=[],this.receiveNotificationBindThis||(this.receiveNotificationBindThis=this.A.bind(this)),this.watch(this.receiveNotificationBindThis);let t=[];if("loop"!==this.type){let e=[this.exec.apply(this.xel,Object.values(this.scope))].flat().map((t=>void 0===t?"":t));if(this.isHash)t=[e.map((t=>new w(j.decode(t))))];else for(let i of e)if(i+="",i.length){let e=k.fromHtml(i,Object.keys(this.scope),this).flat();t.push(e)}}else{let e=this.exec.apply(this.xel,Object.values(this.scope)),i=0;for(let r of e){let r=[];for(let t of this.loopItemEls){let l=t.clone(this.xel,this);l.scope={...this.scope};let s=[e[i],i,e];for(let t in this.loopParamNames)l.scope[this.loopParamNames[t]]=s[t];r.push(l)}t.push(r),i++}}return t}A(t,e,i,r,l){if("loop"!==this.type||!p.arrayStartsWith(e.slice(0,-2),this.watchPaths[0].slice(1))){if(this.childCount=this.getAllChildrenLength(),"complex"!==this.type&&e[e.length-1].match(/^\d+$/)){let i=e.slice(0,-1),r=a(l,i);if(Array.isArray(r)&&p.arrayEq(this.watchPaths[0].slice(1),i)){let i=parseInt(e[e.length-1]);if("remove"===t){for(let t of this.vChildren[i])t.remove();this.vChildren.splice(i,1)}else{if("set"===t&&this.vChildren[i])for(let t of this.vChildren[i])t.remove();"insert"===t&&this.vChildren.splice(i,0,[]),this.vChildren[i]="simple"===this.type?[new w(j.decode(r[i]))]:this.loopItemEls.map((t=>t.clone(this.xel,this)));let e=0,l=this.S(i);for(let t of this.vChildren[i]){t.startIndex=l+e,t.scope={...this.scope};let s=[r[i],i,r];for(let e in this.loopParamNames)t.scope[this.loopParamNames[e]]=s[e];t.apply(this.parent,null),e++}}return void this.F()}}this.apply(),this.F()}}remove(){for(let t of this.watches)v.remove(...t);this.watches=[];for(let t of this.vChildren)for(let e of t)e.remove();if(this.vParent instanceof k){let t=this.vParent.vChildren.indexOf(this);this.vParent.vChildren.splice(t,1)}else for(let t of this.vParent.vChildren){let e=t.indexOf(this);if(e>=0)return void t.splice(e,1)}}getAllChildrenLength(){let t=0;for(let e of this.vChildren)for(let i of e)i.A?t+=i.getAllChildrenLength():t++;return t}S(t){let e=this.startIndex;for(let i of this.vChildren.slice(0,t))for(let t of i)t instanceof O?e+=t.getAllChildrenLength():e++;return e}C(){let t=this.vParent.vChildren.flat(),e=t.indexOf(this);for(let i of t.slice(e+1))if(i instanceof O)return i;return this.vParent.parent===this.parent&&this.vParent instanceof O?this.vParent.C():null}F(){let t=this.getAllChildrenLength()-this.childCount,e=this;for(;e=e.C();)e.startIndex+=t}watch(t){for(let e of this.watchPaths){let i=this.xel;"this"===e[0]?e=e.slice(1):e[0]in this.scope&&(i=this.scope[e[0]],e=e.slice(1)),("object"==typeof i||Array.isArray(i))&&(this.watches.push([i,e,t]),v.add(i,e,t))}}static fromTokens(t,e,i,r){let l=new O;l.vParent=i,i&&(l.xel=i.xel,l.scope={...i.scope}),l.attrName=r,e=(e||[]).slice();let s="#{"==t[0];"${"!=t[0]&&!s||"}"!=t[t.length-1]||(l.isHash=s,t=t.slice(1,-1));let n=t.filter((t=>"whitespace"!==t.type&&"ln"!==t.type)),o=f.o(n,e),[h,a]=f.i(n,e),u=i&&i.xel&&i.xel.constructor||window.RefractCurrentClass;if(a){l.type="loop",l.loopParamNames=h;for(let t of h)e.push(t);l.exec=u.createFunction(...e,"return "+o[0].join("")),l.loopItemEls=1===a.length&&"template"===a[0].type?k.fromTokens(a[0].tokens.slice(1,-1),e):[O.fromTokens(a,e,i)]}else f.t(e)(n)!==n.length&&(l.type="complex"),t=f.replaceHashExpr(t,null,u.name),l.exec=u.createFunction(...e,"return "+t.join(""));for(let t of o)l.watchPaths.push(f.u(t));return l}}r.allowHashTemplates=!0;class k{tagName="";attributes={};attributeExpressions=[];xel=null;el=null;vParent=null;vChildren=[];scope={};startIndex=0;constructor(t,e){this.tagName=t||"",this.attributes=e||{}}apply(t=null,e=null){if(e)this.el=e,e.querySelector("slot")||(this.xel.slotHtml=e.innerHTML),e.innerHTML="";else{let e;if(this.tagName.includes("-")&&customElements.get(this.tagName)){let t=customElements.get(this.tagName),i=[];t.constructorArgs&&(i=t.constructorArgs.map((t=>{if(t in this.attributes){let e=this.attributes[t];if(e&&1===e.length&&e[0]instanceof O)return e[0].exec.apply(this.xel,Object.values(this.scope));if(Array.isArray(e)&&!e.length)return!0;let i=k.evalVAttribute(this,e||[],this.scope).join("");try{i=JSON.parse(i)}catch(t){}return i}}))),e=new t(...i)}else e=document.createElement(this.tagName);if(this.el)this.el.parentNode.insertBefore(e,this.el),this.el.remove();else{let i=t.shadowRoot||t;i!==this.xel&&i.tagName&&i.tagName.includes("-")&&"SLOT"!==e.tagName&&(i=i.querySelector("slot")||i),i.insertBefore(e,i.childNodes[this.startIndex])}this.el=e,_.elsCreated&&_.elsCreated.push("<"+this.tagName+">")}for(let t in this.attributes){let e=this.attributes[t];for(let l of e)if(l instanceof O){let s=l;s.parent=this.el,s.watch((()=>{"value"===t?E(this.xel,this.el,e,this.scope,r||i):this.el.setAttribute(t,k.evalVAttribute(this.xel,e,this.scope).join(""))}))}if(k.setVAttribute(this.xel,this.el,t,e,this.scope),"id"===t&&(this.xel[this.el.getAttribute("id")]=this.el),"data-id"===t&&(this.xel[this.el.getAttribute("data-id")]=this.el),t.startsWith("on")){let e=(this.xel&&this.xel.constructor||window.RefractCurrentClass).createFunction;this.el[t]=i=>{let r=["event","el",...Object.keys(this.scope)],l=this.el.getAttribute(t);e(...r,l).bind(this.xel)(i,this.el,...Object.values(this.scope))}}"shadow"===t&&this.el.attachShadow({mode:this.el.getAttribute("shadow")||"open"})}let i=this.el.hasAttribute("contenteditable")&&"false"!==this.el.getAttribute("contenteditable"),r="textarea"===this.tagName,l="input"===this.tagName&&!["button","checkbox","color","file","hidden","image","radio","reset","submit"].includes(this.el.getAttribute("type"));if("value"in this.attributes){let t=this.attributes.value;if(1===t.length&&t[0]&&"simple"===t[0].type){let e={this:this.xel,...this.scope};r||i||l?this.el.addEventListener("input",(()=>{let r=this.el.getAttribute("type")||"",l=i?this.el.innerHTML:this.el.value;"number"!==r&&"range"!==r||(l=parseFloat(l)),"datetime-local"!==r&&"datetime"!==r||(l=new Date(l)),a(e,t[0].watchPaths[0])!==l&&a(e,t[0].watchPaths[0],l)}),!0):this.el.addEventListener("change",(()=>{let r;if("select"===this.tagName&&this.el.hasAttribute("multiple")){let i=Array.from(this.el.children).filter((t=>t.selected)).map((t=>t.value));a(e,t[0].watchPaths[0],i)}else r=i?this.el.innerHTML:this.el.value;a(e,t[0].watchPaths[0],r)}),!0)}}let s=0;if("slot"===this.tagName){let t=k.fromHtml(this.xel.slotHtml,Object.keys(this.scope),this);for(let e of t)e.scope={...this.scope},e.startIndex=s,window.inSlot=!0,s+=e.apply(this.el),window.inSlot=!1}for(let t of this.vChildren)t.scope={...this.scope},t.startIndex=s,s+=t.apply(this.el);return"value"in this.attributes&&E(this.xel,this.el,this.attributes.value,this.scope,r||i),1}clone(t,e){let i=new k(this.tagName);i.xel=t||this.xel;for(let t in this.attributes){i.attributes[t]=[];for(let e of this.attributes[t])i.attributes[t].push(e instanceof O?e.clone(i.xel,this):e)}for(let t of this.attributeExpressions)i.attributeExpressions.push(t.clone(i.xel,this));for(let t of this.vChildren)i.vChildren.push(t.clone(i.xel,i));return i}remove(){for(let t of this.vChildren)t.remove();this.el.parentNode.removeChild(this.el)}static evalVAttribute2(t,e,i={}){let r=e.map((e=>e instanceof O?e.exec.apply(t,Object.values(i)):e));return 1===r.length?r[0]:r.flat().join("")}static evalVAttribute(t,e,i={}){let r=[];for(let l of e)if(l instanceof O){let e=l.exec.apply(t,Object.values(i));if(Array.isArray(e)||e instanceof Set)e=Array.from(e).join(" ");else if("object"==typeof e){let t=[];for(let i in e)t.push(i+": "+e[i]+"; ");e=t.join("")}r.push(e)}else r.push(l);return r}static setVAttribute(t,e,i,r,l={}){e.setAttribute(i,k.evalVAttribute(t,r,l).join(""))}static fromHtml(e,i=[],l=null){let s=t(r,[e].flat().join(""),"template");return k.fromTokens(s,i,l)}static fromTokens(t,e=[],i=null,r=!1,l=0){let s=[];if(!t.length)return[];do{let n=t[l];if("text"===n.type){let t=new w(j.decode(n));s.push(t)}else if("expr"===n.type)s.push(O.fromTokens(n.tokens,e,i));else if("openTag"===n.type){let r=new k;r.vParent=i,r.xel=i?.xel,i&&(r.scope={...i.scope});let o="",f=n.tokens.filter((t=>"whitespace"!==t.type));for(let t,l=0;t=f[l];l++)if(0===l)r.tagName=t.slice(1);else if("attribute"===t.type)o=t,r.attributes[o]=[];else if(o&&"="==f[l-1]){let l=[];if("string"===t.type)for(let r of t.tokens.slice(1,-1))l.push("expr"===r.type?O.fromTokens(r.tokens,e,i,o):r+"");else"expr"===t.type&&l.push(O.fromTokens(t.tokens,e,i,o));r.attributes[o]=l,o=void 0}else"expr"===t.type&&r.attributeExpressions.push(O.fromTokens(t.tokens,e,i));"/>"==f[f.length-1]||["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr","command","keygen","menuitem"].includes(r.tagName)||(l++,r.vChildren=k.fromTokens(t,e,r,!1,l),l=r.vChildren.index),s.push(r)}else if("closeTag"===n.type)break;if(s.length===r)break;l++}while(t.length>l);return s.index=l,s}}function E(t,e,i,r,l){"SELECT"===e.tagName?A(e,k.evalVAttribute2(t,i,r)):l?e.innerHTML=k.evalVAttribute(t,i,r).join(""):e.value=k.evalVAttribute2(t,i,r)}function A(t,e){for(let i of t.children)i.selected=e.includes(i.value)}let S={},F=new WeakMap,C=new WeakMap;function T(t,e=!0,i=document){if(e&&(t=t.trim()),t.match(/^<\S+-\S+/)){let e=F.get(i);return e||F.set(i,e=i.createElement("div")),e.innerHTML=t,e.removeChild(e.firstChild)}let r=S[t];if(r)return r.cloneNode(!0);let l=C.get(i);return l||C.set(i,l=i.createElement("template")),l.innerHTML=t,l.content.querySelector("slot")||(S[t]=l.content.firstChild.cloneNode(!0)),l.content.removeChild(l.content.firstChild)}r.allowHashTemplates=!0;class _ extends HTMLElement{static virtualElement;static constructorArgs=[];static elsCreated=!1;slotHtml="";static preCompile(e){let i={};i.self=e,i.constructorArgs=[];let s=function t(e){let i=[];for(let r of e)"comment"!==r.type?i.push(r):r.tokens&&(r.tokens=t(e));return i}(t(r,""+e));{let t=l.matchFirst(["html",f.ws,"=",f.ws,{type:"template"}],s),e=s[t.index+t.length-1].tokens.slice(1,-1);"text"!==e[0].type||e[0].trim().length||(e=e.slice(1)),i.virtualElement=k.fromTokens(e,[],null,1)[0]}{let t,e,r=s.slice(),n=l.matchFirst(["constructor",f.ws,"("],r);if(n){let s=l.matchFirst(f.argList,r,n.index+n.length);i.constructorArgs=f.filterArgNames(s);let o=l.matchFirst(["super",f.ws,"(",f.argList,")",f.ws,";"],r,s.index+s.length);t=o.index+o.length,e=["//Begin Refract injected code.",...i.constructorArgs.map((t=>[`if (${t}===undefined && this.hasAttribute('${t}')) {`,`   ${t} = this.getAttribute('${t}');`,`   try { ${t} = JSON.parse(${t}) } catch(e) {};`,"}"])).flat(),"this.virtualElement = this.constructor.virtualElement.clone(this);","this.virtualElement.apply(this, this);","//End Refract injected code."].join("\r\n\t\t\t")}else t=l.matchFirst(["{"],r).index+1,e="//Begin Refract injected code.\r\n\t\tconstructor() {\r\n\t\t\tsuper();\r\n\t\tthis.virtualElement = this.constructor.virtualElement.clone(this);\r\n\t\tthis.virtualElement.apply(this, this);\r\n\t\t}\r\n\t\t//End Refract injected code.";r.splice(t,0,"\r\n\t\t\t"+e),i.code=r.join("")}return i}static decorate(t,e){t.constructorArgs=e.constructorArgs,t.virtualElement=e.virtualElement;for(let i of Object.getOwnPropertyNames(e.self.prototype))"constructor"!==i&&(t.prototype[i]=e.self.prototype[i]);for(let i of Object.getOwnPropertyNames(e.self))i in _||(t[i]=e.self[i]);customElements.define(t.virtualElement.tagName.toLowerCase(),t)}static htmlEncode(t,e=""){return t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\a0/g,"&nbsp;"),e.includes("'")&&(t=t.replace(/'/g,"&apos;")),e.includes('"')&&(t=t.replace(/"/g,"&quot;")),t}static htmlDecode(t){return N.innerHTML=t,N.value}static compile(){return`\n\t\t\t(() => {\n\t\t\t\twindow.RefractCurrentClass = ${this.name};\n\t\t\t\t${this.name}.createFunction = (...args) => eval(\`(function(\${args.slice(0, -1).join(',')}) {\${args[args.length-1]}})\`);\n\t\t\t\tlet compiled = ${this.name}.preCompile(${this.name});\n\t\t\t\t${this.name} = eval('('+compiled.code+')');\t\t\t\t\n\t\t\t\t${this.name}.decorate(${this.name}, compiled);\n\t\t\t\tdelete window.RefractCurrentClass;\n\t\t\t\treturn ${this.name};\t\n\t\t\t})();\n\t\t\n\t\t`}}Object.defineProperty(_,"h",{set:t=>_.htmlEncode(t)});var N=document.createElement("textarea");export default _;